<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* CONFIG DO FIREBASE (COLE A SUA AQUI) */
 const firebaseConfig = {
    apiKey: "AIzaSyDe4V1HgiL47Ut81Tn6B2dRxZtHZ-AdkVc",
    authDomain: "mm2-tracker-c22d8.firebaseapp.com",
    projectId: "mm2-tracker-c22d8",
    storageBucket: "mm2-tracker-c22d8.firebasestorage.app",
    messagingSenderId: "765311899661",
    appId: "1:765311899661:web:3797d10db4fb7e5e229d44",
    measurementId: "G-YC940LWFSS"
  };

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* LOGIN SIMPLES */
let user = localStorage.getItem("user");

if (!user) {
  user = prompt("Digite seu nome:");
  localStorage.setItem("user", user);
}

/* VARIÁVEIS */
let contador = 0;
let vitorias = 0;

/* CARREGAR DADOS */
async function carregar() {
  const ref = doc(db, "players", user);
  const snap = await getDoc(ref);

  if (snap.exists()) {
    const data = snap.data();
    contador = data.contador || 0;
    vitorias = data.vitorias || 0;
  }

  atualizar();
}

/* SALVAR ONLINE */
async function salvar() {
  const ref = doc(db, "players", user);

  await setDoc(ref, {
    contador,
    vitorias,
    atualizado: new Date()
  });
}

/* ATUALIZAR UI */
function atualizar() {
  document.getElementById("contador").innerText = contador;
  document.getElementById("vitorias").innerText = vitorias;
}

/* FUNÇÕES */
window.alterar = function(v){
  contador += v;
  if (contador < 0) contador = 0;
  atualizar();
  salvar();
}

window.addVitoria = function(){
  vitorias++;
  atualizar();
  salvar();
}

/* INICIAR */
carregar();
</script>
