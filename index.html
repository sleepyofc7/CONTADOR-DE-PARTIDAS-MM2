<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* CONFIG DO FIREBASE (SUA) */
const firebaseConfig = {
  apiKey: "AIzaSyDe4V1HgiL47Ut81Tn6B2dRxZtHZ-AdkVc",
  authDomain: "mm2-tracker-c22d8.firebaseapp.com",
  projectId: "mm2-tracker-c22d8",
  storageBucket: "mm2-tracker-c22d8.firebasestorage.app",
  messagingSenderId: "765311899661",
  appId: "1:765311899661:web:3797d10db4fb7e5e229d44"
};

/* INICIAR FIREBASE */
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* LOGIN SIMPLES */
let user = localStorage.getItem("user");

if (!user) {
  user = prompt("Digite seu nome:");
  localStorage.setItem("user", user);
}

/* VARIÁVEIS */
let contador = 0;
let vitorias = 0;

/* PEGAR ELEMENTOS */
const contadorEl = document.getElementById("contador");
const vitoriasEl = document.getElementById("vitorias");

/* ATUALIZAR TELA */
function atualizar() {
  if (contadorEl) contadorEl.innerText = contador;
  if (vitoriasEl) vitoriasEl.innerText = vitorias;
}

/* CARREGAR DADOS */
async function carregar() {
  try {
    const ref = doc(db, "players", user);
    const snap = await getDoc(ref);

    if (snap.exists()) {
      const data = snap.data();
      contador = data.contador || 0;
      vitorias = data.vitorias || 0;
    }

    atualizar();
  } catch (e) {
    console.error("Erro ao carregar:", e);
  }
}

/* SALVAR DADOS */
async function salvar() {
  try {
    const ref = doc(db, "players", user);

    await setDoc(ref, {
      contador,
      vitorias,
      atualizado: new Date()
    });

  } catch (e) {
    console.error("Erro ao salvar:", e);
  }
}

/* FUNÇÕES GLOBAIS */
window.alterar = function(v){
  contador += v;
  if (contador < 0) contador = 0;
  atualizar();
  salvar();
}

window.addVitoria = function(){
  vitorias++;
  atualizar();
  salvar();
}

/* INICIAR */
carregar();

</script>
